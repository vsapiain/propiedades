{% extends "base2.html" %}
{% block title %}Arriendos y ventas de propiedades{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <div id="crumbs">
                <ul>
                    <li><a href="/"> Inicio</a></li>
                    <li ><a class = "current" href="#">Cuenta de usuario</a></li>
                </ul>
            </div>
        </div>
        <div class="col-md-9">
            <button id="btnDatosComerciales" type="button" class="margin-top-form top-button pull-right"><i class="fa fa-credit-card-alt" aria-hidden="true"></i> Datos comerciales</button>
            <button id="btnPlanes" type="button" class="margin-top-form top-button pull-right"><i class="fa fa-list-ol" aria-hidden="true"></i> Planes y productos</button>
            <button id="btnCuenta" type="button" class="margin-top-form top-button pull-right"><i class="fa fa-user" aria-hidden="true"></i> Cuenta de usuario</button>
            <button id="btnDatosGenerales" type="button" class="margin-top-form margin-left-form top-button pull-right"><i class="fa fa-pencil" aria-hidden="true"></i> Datos generales</button>
        </div>
    </div>
</div>
<div class="container">
    <div class="row margin-button-form-2">
         <div class="col-md-3">
           <div>
                <div class="card-flat card-block ">
                   <div class="margin-left-form">
                   <div>
                        <i class="fa fa-user-circle-o fa-lg" aria-hidden="true"></i>
                        <label class="contenido"><span class="usernameLogin"></span></label>
                    </div>
                    <div>
                        <i class="fa fa-credit-card-alt" aria-hidden="true"></i>
                        <label class="contenido"><span class="plan"></span></label>
                    </div>
                   </div>
                </div>
            </div>
            <div class="sticky border filtersContainer" id="filtersContainer">
                <div class="userOn filterContainer filtro p-4 bg-white">
                    <div class="panel_filter">
                        &nbsp;&nbsp;
                        <label class="destacado_lbl margin-top-form-4">Cuenta de usuario</label>
                    </div>
                </div>
                <div class="userOn filterContainer filtro bg-white">
                    <div class="list-group">
                        <a href="#" class="list-group-item list-group-item-action">
                            Publicar aviso
                        </a>
                        <a href="/propiedades/" class="list-group-item list-group-item-action">Buscar propiedad</a>
                    </div>
                </div>
            </div>
        </div>
         <div class="col-md-9">
               <div class="card-flat departure-card card-block ">
                   <label class="titulo"><i class="fa fa-user" aria-hidden="true"></i> Mi configuración-cuenta de usuario</label>
                   <br>
                  <form id="formDataAccount" method="post">
                    <input type="hidden" id = "tokenHd" name="tokenHd">
                    <input type="hidden" id = "hdEmail" name="hdEmail">
                    <input type="hidden" id = "hdUbicacion" name="hdUbicacion">
                    <div class="form-row">
                        <div class="row">
                            <div class="form-group col-md-5">
                                <label for="txtClaveActual" class="titulo-campo-form">Contraseña actual</label> <i class="fa fa-question-circle" aria-hidden="true"></i>
                                <input class="form-control" name="txtClaveActual" id="txtClaveActual" type="password" data-minlength="6"  data-error="Debe ingresar un mínimo de 6 caracteres" placeholder="" required>
                                <div class="help-block with-errors"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-5">
                                <label for="txtClave1" class="titulo-campo-form">Nueva contraseña</label>
                                <input class="form-control" name="txtClave1" id="txtClave1" type="password" data-minlength="6" data-error="Debe ingresar un mínimo de 6 caracteres" placeholder="" required>
                                <div class="help-block with-errors"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-5">
                                <label for="txtClave2" class="titulo-campo-form">Repetir nueva contraseña</label>
                                <input class="form-control" name="txtClave2" id="txtClave2" type="password" data-minlength="6" data-error="Debe ingresar un mínimo de 6 caracteres" placeholder="" required>
                                <div class="help-block with-errors"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                               <hr/>
                            </div>
                            <div class="form-group col-md-3">
                               <button type="submit" id="btnGuardar" class="btn btn-large btn-primary btn-block">Guardar cambios</button>
                            </div>
                        </div>

                   </div>
                   </form>
               </div>
         </div>
    </div>
</div>
 {% endblock %}
{% block content_script %}
<script>
    $(document).ready(function(){
        initLocal();
        $("#btnDatosGenerales").click(function(){
            window.location = "/usuarios/generales/editar";
        });
         $('#formDataAccount').validator().on('submit', function (e) {
             if (!e.isDefaultPrevented()){
                var form = $(this).serialize();
                run_waitMe($(".omb_loginForm"), 2, 'facebook');
                $.ajax
                ({
                  type: "POST",
                  data: form,
                  url: "/SetAccount/",
                  async: false,
                  dataType: 'json',
                  beforeSend : function(req) {
                    req.setRequestHeader('Authorization', localStorage.token);
                  },
                  success: function (data){
                    if (data.error!='1'){
                        $("#txtClaveActual").val("");
                        $("#txtClave1").val("");
                        $("#txtClave2").val("");
                        ok_msg("Datos generales",data.msg,2500);
                    }
                  },
                  error: function(xhr, status, error) {
                     error_msg("Error","Se ha producido un error. Intente realizar esta acción nuevamente.",2500);
                  }
                });
                $('.omb_loginForm').waitMe('hide');
             }
             return false;
         });
    });
    function initLocal(){
        var activ_msg = '{{activar_msg}}';
        if (activ_msg == '1'){
            var msg = '{{msg}}';
            var error = '{{error}}';
            if (error != '1')
                ok_msg("Datos generales",msg,1500);
            else
                error_msg("Error",msg,2500);
        }
        $("#tokenHd").val(localStorage.token);
        $("#btnCuenta").css("background","#DDDDDD");
        $("#txtClaveActual").focus();
        $('#formDataAccount').validator();
    }
</script>
{% endblock %}